import THREE from 'three';

function ajax(config) {
    let request = new XMLHttpRequest(),
        method  = config.method || 'GET',
        fileSize;

    function executor(resolve, reject) {

        reject  = reject  || function () {};
        resolve = resolve || function () {};

        if (typeof config.url === 'undefined' || config.url === '') {
            reject('please provide a url');
            return;
        }

        request.onload = function (e) {
            if (request.status !== 200) {
                reject(request.status);

                return;
            }

            if (config.responseType === 'json') {
                fileSize = request.response.length;

                resolve(JSON.parse(request.response), fileSize);

                request = null;

            } else {
                resolve(request.response);

                request = null;
            }
        };

        request.addEventListener('error', (e) => reject(e), false);

        request.open(method, config.url, true);

        if (config.overrideMimeType) {
            request.overrideMimeType(config.overrideMimeType);
        }

        if (config.responseType) {
            if (config.responseType === 'json') {
                request.responseType = 'text';

            } else {
                request.responseType = config.responseType;
            }
        }

        if (method === 'POST') {
            request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        }

        if (config.data) {
            request.send(config.data);

        } else {
            request.send();
        }
    }

    return new Promise(executor);
}


function guid() {
    function s4() {
        return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
    }

    return 'key_' + s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
}


export {ajax, guid};
